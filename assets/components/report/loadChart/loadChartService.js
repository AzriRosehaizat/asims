application.service('loadChartService', function($mdDialog, reportService) {

    var self = this;
    var docDefinition = {
        info: {
            title: 'Faculty Load Chart',
            author: 'Auto-generated by Application',
            subject: 'Faculty Load Chart',
        },
        content: [],
        styles: reportService.setStyle()
    };

    self.openLoadDialog = function(ev, entity, tabs) {
        $mdDialog.show({
                controller: 'dialogController as ctrl',
                templateUrl: 'components/report/loadChart/loadDialog.html',
                parent: angular.element(document.body),
                targetEvent: ev,
                clickOutsideToClose: true
            })
            .then(function(range) {
                console.log(tabs);
                docDefinition.content = [];
                
                var data = formatData(entity, tabs, range);
                generateReport(data);
                openPdf();
            });
    };
    
    function formatData(entity, tabs, range) {
        var data = {};
        
        // Regular staff information
        entity.name = entity.firstName + ' ' + entity.lastName;
        data.info = entity;
        
        var tActivity = tabs.teachingActivity.gridOptions.data;
        var overload  = tabs.overload.gridOptions.data;
        var FCECredit = tabs.FCECredit.gridOptions.data;
        var FCEDebit  = tabs.FCEDebit.gridOptions.data;
        var load      = tabs.load.gridOptions.data;
        var reduction = tabs.loadReduction.gridOptions.data;
        
        // Main table
        data.main = {};
        
        // Overload course table
        data.overload = {};
        
        // Load reduction table
        data.reduction = {};
        
        return data;
    }

    function generateReport(data) {
        docDefinition.content.push({
                text: 'FACULTY LOAD CHART',
                style: 'header'
            },
            reportService.getStaffInfo(data.info),
            // reportService.setTableHead(data.main),
            {
                text: "Overload Teaching ",
                style: "tableHeader"
            },
            //reportService.setTableHead(data.overload),
            {
                text: "Load Reductions ",
                style: "tableHeader"
            },
            //reportService.setTableHead(data.reduction),
            reportService.setFooter()
        );
    }

    function openPdf() {
        pdfMake.createPdf(docDefinition).open();
    }
});